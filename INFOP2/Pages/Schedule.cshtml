@page
@model INFOP2.Pages.Schedule
@{
    ViewData["Title"] = "Schedule";
    Layout = "_Layout";
}

<div class="container-fluid px-4 py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                    <h2 class="fw-bold mb-1">@ViewData["Title"]</h2>
                    <p class="text-muted mb-0">Manage schedule details</p>
                </div>
                <div class="text-end">
                    <h4 class="h6 mb-1">Welcome back,</h4>
                    <p class="text-primary mb-0 fw-bold">@User.Identity?.Name</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Card -->
    <div id="success-card" class="card border-0 shadow-sm mb-4 d-none">
        <div class="card-body d-flex justify-content-between align-items-center p-3">
            <div>
                <h5 class="card-title text-success mb-1">Success!</h5>
                <p class="card-text mb-0" id="success-message">Action completed successfully!</p>
            </div>
            <button type="button" class="btn-close" aria-label="Close" onclick="$('#success-card').addClass('d-none');"></button>
        </div>
    </div>

    <!-- Toolbar -->
    <div class="d-flex justify-content-end mb-4 gap-2">
        <button class="btn btn-success d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#addDriverModal">
            <i class="fa fa-plus me-2"></i> Add Driver
        </button>
        <button class="btn btn-primary d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#addEventModal">
            <i class="fa-solid fa-calendar-plus me-2"></i> Create Event
        </button>
        <button class="btn btn-outline-secondary d-flex align-items-center" id="exportBtnSched" data-bs-tooltip="tooltip" title="Export to Excel">
            <i class="fa-solid fa-download me-2"></i> Export
        </button>
    </div>

    <!-- Schedule Events Container -->
    <div id="events-container">
        <!-- Dynamically populated by JavaScript -->
    </div>
</div>

<!-- Modal: Add Driver -->
<div class="modal fade" id="addDriverModal" tabindex="-1" aria-labelledby="addDriverModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-success text-white rounded-top">
                <h5 class="modal-title">Add New Driver</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="add-driver-form">
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Driver Name</label>
                        <input type="text" class="form-control" id="add-driver-name" placeholder="Enter driver name" required />
                        <span class="text-danger small" id="add-driver-name-error"></span>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Contact Number</label>
                        <input type="text" class="form-control" id="add-driver-contact" placeholder="+966 5xx xxx xxx" />
                        <span class="text-danger small" id="add-driver-contact-error"></span>
                    </div>
                </div>
                <div class="modal-footer bg-light rounded-bottom">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Driver</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Edit Driver -->
<div class="modal fade" id="editDriverModal" tabindex="-1" aria-labelledby="editDriverModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white rounded-top">
                <h5 class="modal-title">Edit Driver</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="edit-driver-form">
                <div class="modal-body p-4">
                    <input type="hidden" id="edit-driver-id" />
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Driver Name</label>
                        <input type="text" class="form-control" id="edit-driver-name" required />
                        <span class="text-danger small" id="edit-driver-name-error"></span>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Contact Number</label>
                        <input type="text" class="form-control" id="edit-driver-contact" />
                        <span class="text-danger small" id="edit-driver-contact-error"></span>
                    </div>
                </div>
                <div class="modal-footer bg-light rounded-bottom">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Schedule Event -->
<div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white rounded-top">
                <h5 class="modal-title">Add Schedule Event</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="add-event-form">
                <div class="modal-body p-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Event</label>
                            <input type="text" class="form-control" id="add-event-event" required />
                            <span class="text-danger small" id="add-event-event-error"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Subject</label>
                            <input type="text" class="form-control" id="add-event-subject" required />
                            <span class="text-danger small" id="add-event-subject-error"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Date and Time</label>
                            <input type="datetime-local" class="form-control" id="add-event-datetime" required />
                            <span class="text-danger small" id="add-event-datetime-error"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Status</label>
                            <select class="form-select" id="add-event-status" required>
                                <option value="" selected disabled>Select status</option>
                                <option value="Scheduled">Scheduled</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                            <span class="text-danger small" id="add-event-status-error"></span>
                        </div>
                        <!-- Drivers Section -->
                        <div class="col-12">
                            <label class="form-label fw-semibold">Drivers</label>
                            <div id="add-event-drivers" class="border p-3 rounded">
                                <!-- Dynamically added driver fields -->
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm mt-2 d-flex align-items-center" onclick="addDriver('add')">
                                <i class="fa fa-plus me-2"></i>Add Driver
                            </button>
                            <span class="text-danger small" id="add-event-drivers-error"></span>
                        </div>
                        
                        <!-- Programs Section -->
                        <div class="col-12">
                            <label class="form-label fw-semibold">Programs</label>
                            <div id="add-event-programs" class="border p-3 rounded">
                                <!-- Dynamically added program fields -->
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm mt-2 d-flex align-items-center" onclick="addProgram('add')">
                                <i class="fa fa-plus me-2"></i>Add Program
                            </button>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Note</label>
                            <input type="text" class="form-control" id="add-event-note" />
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-semibold">Remarks</label>
                            <textarea class="form-control" id="add-event-remarks" rows="2"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-semibold">Closing Notes</label>
                            <textarea class="form-control" id="add-event-closing-notes" rows="2"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-semibold">Bible Verse</label>
                            <textarea class="form-control" id="add-event-verse" rows="3" placeholder="Enter a Bible verse (e.g., For God so loved the world... — John 3:16)"></textarea>
                            <span class="text-danger small" id="add-event-verse-error"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light rounded-bottom">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Event</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Edit Schedule Event -->
<div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white rounded-top">
                <h5 class="modal-title">Edit Schedule Event</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="edit-event-form">
                <div class="modal-body p-4">
                    <input type="hidden" id="edit-event-id" />
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Event</label>
                            <input type="text" class="form-control" id="edit-event-event" required />
                            <span class="text-danger small" id="edit-event-event-error"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Subject</label>
                            <input type="text" class="form-control" id="edit-event-subject" required />
                            <span class="text-danger small" id="edit-event-subject-error"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Date and Time</label>
                            <input type="datetime-local" class="form-control" id="edit-event-datetime" required />
                            <span class="text-danger small" id="edit-event-datetime-error"></span>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Status</label>
                            <select class="form-select" id="edit-event-status" required>
                                <option value="" selected disabled>Select status</option>
                                <option value="Scheduled">Scheduled</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                            <span class="text-danger small" id="edit-event-status-error"></span>
                        </div>
                        <!-- Drivers Section -->
                        <div class="col-12">
                            <label class="form-label fw-semibold">Drivers</label>
                            <div id="edit-event-drivers" class="border p-3 rounded">
                                <!-- Dynamically added driver fields -->
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm mt-2 d-flex align-items-center" onclick="addDriver('edit')">
                                <i class="fa fa-plus me-2"></i>Add Driver
                            </button>
                            <span class="text-danger small" id="edit-event-drivers-error"></span>
                        </div>
                       
                        <!-- Programs Section -->
                        <div class="col-12">
                            <label class="form-label fw-semibold">Programs</label>
                            <div id="edit-event-programs" class="border p-3 rounded">
                                <!-- Dynamically added program fields -->
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm mt-2 d-flex align-items-center" onclick="addProgram('edit')">
                                <i class="fa fa-plus me-2"></i>Add Program
                            </button>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-semibold">Note</label>
                            <input type="text" class="form-control" id="edit-event-note" />
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-semibold">Remarks</label>
                            <textarea class="form-control" id="edit-event-remarks" rows="2"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-semibold">Closing Notes</label>
                            <textarea class="form-control" id="edit-event-closing-notes" rows="2"></textarea>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-semibold">Bible Verse</label>
                            <textarea class="form-control" id="edit-event-verse" rows="3"></textarea>
                            <span class="text-danger small" id="edit-event-verse-error"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light rounded-bottom">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Event Modal -->
<div class="modal fade" id="deleteEventModal" tabindex="-1" aria-labelledby="deleteEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-danger text-white rounded-top">
                <h5 class="modal-title" id="deleteEventModalLabel">Delete Schedule Event</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4 text-center">
                <i class="fa-solid fa-triangle-exclamation text-danger fa-3x mb-3"></i>
                <p class="mb-0">Are you sure you want to delete this schedule event?</p>
                <p class="text-muted small">This action cannot be undone.</p>
                <input type="hidden" id="delete-event-id" />
            </div>
            <div class="modal-footer bg-light rounded-bottom">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Font Awesome (for icons) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <!-- Select2 CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        window.firebaseConfig = @Html.Raw(Model.FirebaseConfigJson);
    </script>
    <script src="~/js/schedule-page.js"></script>
}