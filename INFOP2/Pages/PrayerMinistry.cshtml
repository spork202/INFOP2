@page
@model INFOP2.Pages.PrayerMinistry
@{
    ViewData["Title"] = "Prayer Ministry";
    Layout = "_Layout";
}

<div class="container-fluid px-4 py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                    <h2 class="fw-bold mb-1">@ViewData["Title"]</h2>
                    <p class="text-muted mb-0">Manage your prayer events</p>
                </div>
                <div class="text-end">
                    <h4 class="h6 mb-1">Welcome back,</h4>
                    <p class="text-primary mb-0 fw-bold">@User.Identity?.Name</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Card -->
    <div id="success-card" class="card border-0 shadow-sm mb-4 d-none">
        <div class="card-body d-flex justify-content-between align-items-center p-3">
            <div>
                <h5 class="card-title text-success mb-1">Success!</h5>
                <p class="card-text mb-0" id="success-message">Action completed successfully!</p>
            </div>
            <button type="button" class="btn-close" aria-label="Close" onclick="$('#success-card').addClass('d-none');"></button>
        </div>
    </div>

    <!-- Add Event Button -->
    <div class="d-flex justify-content-end mb-4 gap-2">
        <button class="btn btn-success d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#addEventModal">
            <i class="fa-solid fa-plus me-2"></i> Add Prayer Event
        </button>
        <button class="btn btn-outline-secondary d-flex align-items-center" id="exportBtnMinistry" data-bs-tooltip="tooltip" title="Export to Excel">
            <i class="fa-solid fa-download me-2"></i> Export
        </button>
    </div>

    <!-- Prayer Event Cards -->
    <div id="events-container" class="col-md-12">
        <!-- Dynamically populated by JavaScript -->
    </div>
</div>

<!-- Add Event Modal -->
<div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-success text-white rounded-top">
                <h5 class="modal-title" id="addEventModalLabel">Add Prayer Event</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="add-event-form">
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Title</label>
                        <input type="text" class="form-control" id="add-event-title" placeholder="Enter prayer title" required />
                        <span class="text-danger small" id="add-event-title-error"></span>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Date</label>
                        <input type="date" class="form-control" id="add-event-date" required />
                        <span class="text-danger small" id="add-event-date-error"></span>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Notes</label>
                        <input type="text" class="form-control" id="add-event-notes" placeholder="Enter prayer notes" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Remarks</label>
                        <textarea class="form-control" id="add-event-remarks" rows="3" placeholder="Enter remarks"></textarea>
                    </div>
                </div>
                <div class="modal-footer bg-light rounded-bottom">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Event</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Event Modal -->
<div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white rounded-top">
                <h5 class="modal-title" id="editEventModalLabel">Edit Prayer Event</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="edit-event-form">
                <div class="modal-body p-4">
                    <input type="hidden" id="edit-event-id" />
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Title</label>
                        <input type="text" class="form-control" id="edit-event-title" required />
                        <span class="text-danger small" id="edit-event-title-error"></span>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Date</label>
                        <input type="date" class="form-control" id="edit-event-date" required />
                        <span class="text-danger small" id="edit-event-date-error"></span>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Notes</label>
                        <input type="text" class="form-control" id="edit-event-notes" />
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Remarks</label>
                        <textarea class="form-control" id="edit-event-remarks" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer bg-light rounded-bottom">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Event Modal -->
<div class="modal fade" id="deleteEventModal" tabindex="-1" aria-labelledby="deleteEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-danger text-white rounded-top">
                <h5 class="modal-title" id="deleteEventModalLabel">Delete Prayer Event</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4 text-center">
                <i class="fa-solid fa-triangle-exclamation text-danger fa-3x mb-3"></i>
                <p class="mb-0">Are you sure you want to delete this prayer event?</p>
                <p class="text-muted small">This action cannot be undone.</p>
                <input type="hidden" id="delete-event-id" />
            </div>
            <div class="modal-footer bg-light rounded-bottom">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Font Awesome (for icons) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <script>
        window.firebaseConfig = @Html.Raw(Model.FirebaseConfigJson);
    </script>
    <script src="~/js/prayer-ministry-page.js"></script>
}